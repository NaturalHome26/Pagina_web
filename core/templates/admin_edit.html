{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Producto - Admin</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<header class="top-header">
    <div class="logo">NATURAL HOME - Admin</div>
    <a href="{% url 'admin_products' %}" class="btn-volver"><i class="fas fa-arrow-left"></i> Volver</a>
</header>

<main class="admin-container">
    <div class="admin-header">
        <h2><i class="fas fa-edit"></i> Editar Producto</h2>
    </div>

    {% if error %}
    <div class="alert-error">
        <i class="fas fa-exclamation-circle"></i> {{ error }}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="admin-form" id="productForm">
        {% csrf_token %}

        <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-info-circle"></i> Información Básica</h3>

            <div class="form-group">
                <label for="id_titulo"><i class="fas fa-heading"></i> Título *</label>
                <input id="id_titulo" name="titulo" type="text"
                       value="{{ producto.titulo|default_if_none:'' }}" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_precio"><i class="fas fa-tag"></i> Precio ($) *</label>
                    <input id="id_precio" name="precio" type="number" step="0.01" min="0"
                           value="{{ producto.precio|default_if_none:'' }}" required>
                </div>

                <div class="form-group">
                    <label for="id_unidad"><i class="fas fa-weight"></i> Unidad de medida *</label>
                    <select id="id_unidad" name="unidad" required>
                        <option value="">Seleccione unidad</option>
                        <option value="kg" {% if producto.unidad == "kg" %}selected{% endif %}>Kilogramo (kg)</option>
                        <option value="unidad" {% if producto.unidad == "unidad" %}selected{% endif %}>Unidad</option>
                        <option value="paquete" {% if producto.unidad == "paquete" %}selected{% endif %}>Paquete</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="id_categoria"><i class="fas fa-tags"></i> Categoría *</label>
                <select id="id_categoria" name="categoria" required>
                    <option value="">Seleccione categoría</option>
                    <option value="frutas" {% if producto.categoria == "frutas" %}selected{% endif %}>Frutas</option>
                    <option value="verduras" {% if producto.categoria == "verduras" %}selected{% endif %}>Verduras</option>
                    <option value="otros" {% if producto.categoria == "otros" %}selected{% endif %}>Otros</option>
                </select>
            </div>

            <div class="form-group">
                <label for="id_descripcion"><i class="fas fa-align-left"></i> Descripción</label>
                <textarea id="id_descripcion" name="descripcion" rows="4">{{ producto.descripcion }}</textarea>
            </div>

            <div class="form-group">
                <label class="checkbox-label large">
                    <input id="id_fraccionado" name="fraccionado" type="checkbox"
                           {% if producto.fraccionado %}checked{% endif %}>
                    <span class="checkbox-text">Permitir ventas por fracciones (½ kg, ¼ kg, etc.)</span>
                </label>
                <p class="form-help">Solo habilitar si el producto se vende por kilo.</p>
            </div>
        </div>

        <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-image"></i> Imagen del Producto</h3>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_imagen">Subir imagen</label>
                    <div class="file-upload">
                        <input id="id_imagen" name="imagen" type="file" accept="image/*" onchange="previewImage(event)">
                        <div class="file-upload-label">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Click para seleccionar imagen</span>
                        </div>
                    </div>
                    <p class="form-help">Dejar vacío para mantener la imagen actual.</p>
                </div>

                <div class="image-preview">
                    <label>Vista previa</label>
                    {% if producto.imagen %}
                    <img id="preview" src="{{ producto.imagen.url }}" class="thumb-preview">
                    {% else %}
                    <img id="preview" src="{% static 'img/no-image.png' %}" class="thumb-preview">
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3 class="form-section-title"><i class="fas fa-percentage"></i> Configuración de Descuento</h3>

            <div class="form-group">
                <label class="checkbox-label large">
                    <input id="id_descuento_activo" name="descuento_activo" type="checkbox"
                           {% if producto.descuento_activo %}checked{% endif %}
                           onchange="toggleDescuento(this)">
                    <span class="checkbox-text">Activar descuento</span>
                </label>
            </div>

            <div id="wrap_porcentaje" class="form-group descuento-fields"
                 style="display: {% if producto.descuento_activo %}block{% else %}none{% endif %};">

                <label for="id_porcentaje">Porcentaje de descuento</label>
                <div class="descuento-input-group">
                    <input id="id_porcentaje" name="porcentaje_descuento"
                           type="number" min="0" max="100"
                           value="{{ producto.porcentaje_descuento|default_if_none:0 }}">
                    <span class="input-suffix">%</span>
                </div>

                <div class="precio-calculo">
                    <div class="precio-info">
                        <span class="precio-label">Precio original:</span>
                        <span class="precio-valor">${{ producto.precio }}</span>
                    </div>

                    <div class="precio-info">
                        <span class="precio-label">Precio con descuento:</span>
                        <span class="precio-valor descuento">
                            ${{ producto.precio_con_descuento }}
                        </span>
                    </div>

                    <div class="precio-info small">
                        <span class="precio-label">Descuento aplicado:</span>
                        <span class="precio-valor ahorro">
                            {{ producto.porcentaje_descuento }}%
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-save">
                <i class="fas fa-save"></i> Guardar Cambios
            </button>

            <a href="{% url 'admin_products' %}" class="btn-cancel">
                <i class="fas fa-times"></i> Cancelar
            </a>

            <button type="button" class="btn-delete" onclick="confirmarEliminacion()">
                <i class="fas fa-trash"></i> Eliminar Producto
            </button>
        </div>
    </form>

    <form method="post" id="deleteForm" style="display:none;">
        {% csrf_token %}
        <input type="hidden" name="delete" value="1">
    </form>
</main>

<script src="{% static 'js/admin.js' %}"></script>
</body>
</html>