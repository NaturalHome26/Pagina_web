{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuevo Producto - NATURAL HOME</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin_header.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin_dynamic.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin-page">
    <!-- HEADER FIXED DE ADMINISTRADOR -->
    <header class="admin-main-header">
        <div class="admin-main-header-left">
            <div class="logo">NATURAL HOME ADMIN</div>
            <div class="admin-user-info">
                <i class="fas fa-user-circle"></i>
                <span>{{ username }}</span>
            </div>
        </div>
        <div class="admin-main-header-right">
            <a href="{% url 'home' %}" class="btn-header">
                <i class="fas fa-home"></i> Ver Tienda
            </a>
            <a href="{% url 'admin_products' %}" class="btn-header">
                <i class="fas fa-boxes"></i> Productos
            </a>
            <a href="{% url 'admin_logout' %}" class="btn-header btn-logout">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
            </a>
        </div>
    </header>

    <main class="admin-container">
        <div class="admin-header">
            <h2><i class="fas fa-plus-circle"></i> Nuevo Producto</h2>
        </div>

        {% if error %}
        <div class="alert alert-error">
            <i class="fas fa-exclamation-circle"></i> {{ error }}
        </div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" class="admin-form">
            {% csrf_token %}
            
            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-info-circle"></i> Información Básica
                </div>
                
                <div class="form-group">
                    <label for="titulo"><i class="fas fa-heading"></i> Título *</label>
                    <input type="text" id="titulo" name="titulo" required 
                           placeholder="Ej: Manzana Roja" value="{{ producto.titulo|default_if_none:'' }}">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="precio"><i class="fas fa-tag"></i> Precio ($) *</label>
                        <input type="number" id="precio" name="precio" step="0.01" min="0" required 
                               placeholder="0.00" value="{{ producto.precio|default_if_none:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="unidad"><i class="fas fa-balance-scale"></i> Unidad de medida *</label>
                        <select id="unidad" name="unidad" required>
                            <option value="">Seleccionar unidad</option>
                            <option value="kg" {% if producto.unidad == "kg" %}selected{% endif %}>Kilogramo (kg)</option>
                            <option value="unidad" {% if producto.unidad == "unidad" %}selected{% endif %}>Unidad</option>
                            <option value="paquete" {% if producto.unidad == "paquete" %}selected{% endif %}>Paquete</option>
                            <option value="litro" {% if producto.unidad == "litro" %}selected{% endif %}>Litro</option>
                            <option value="docena" {% if producto.unidad == "docena" %}selected{% endif %}>Docena</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="categoria"><i class="fas fa-tags"></i> Categoría *</label>
                        <select id="categoria" name="categoria" required>
                            <option value="">Seleccionar categoría</option>
                            <option value="frutas" {% if producto.categoria == "frutas" %}selected{% endif %}>Frutas</option>
                            <option value="verduras" {% if producto.categoria == "verduras" %}selected{% endif %}>Verduras</option>
                            <option value="canastas" {% if producto.categoria == "canastas" %}selected{% endif %}>Canastas</option>
                            <option value="combos" {% if producto.categoria == "combos" %}selected{% endif %}>Combos</option>
                            <option value="otros" {% if producto.categoria == "otros" %}selected{% endif %}>Otros</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="descripcion"><i class="fas fa-align-left"></i> Descripción</label>
                    <textarea id="descripcion" name="descripcion" rows="4" 
                              placeholder="Ingresa una descripción detallada del producto...">{{ producto.descripcion|default_if_none:'' }}</textarea>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-images"></i> Imágenes del Producto
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-image"></i> Imagen Principal *</label>
                    <div class="file-upload">
                        <input type="file" id="imagen" name="imagen" accept="image/*" required>
                        <label for="imagen" class="file-upload-label">
                            <i class="fas fa-cloud-upload-alt fa-2x"></i>
                            <span>Haz clic para subir la imagen principal</span>
                            <span class="form-help">Formatos: JPG, PNG, GIF. Tamaño máximo: 5MB</span>
                        </label>
                    </div>
                    <div class="image-preview hidden" id="imagePreview">
                        <label>Vista previa:</label>
                        <img id="previewImage" class="thumb-preview" src="#" alt="Vista previa">
                        <div class="image-info">
                            <i class="fas fa-info-circle"></i>
                            <span>La imagen se mostrará aquí</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-section-title">
                    <i class="fas fa-percentage"></i> Descuento y Fraccionado
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label large">
                        <input type="checkbox" name="descuento_activo" id="descuento_activo">
                        <span class="checkbox-text">¿Este producto tiene descuento?</span>
                    </label>

                    <div class="descuento-fields hidden" id="descuentoFields">
                        <div class="descuento-input-group">
                            <label for="porcentaje_descuento">Porcentaje de descuento:</label>
                            <input type="number" id="porcentaje_descuento" name="porcentaje_descuento" 
                                   min="1" max="99" value="0">
                            <span class="input-suffix">%</span>
                        </div>
                        
                        <div class="precio-calculo">
                            <div class="precio-info">
                                <span class="precio-label">Precio original:</span>
                                <span class="precio-valor">$<span id="precioOriginal">0.00</span></span>
                            </div>
                            <div class="precio-info">
                                <span class="precio-label">Descuento aplicado:</span>
                                <span class="precio-valor descuento">- $<span id="descuentoAplicado">0.00</span></span>
                            </div>
                            <div class="precio-info small">
                                <span class="precio-label">Ahorro:</span>
                                <span class="precio-valor ahorro"><span id="porcentajeAhorro">0</span>%</span>
                            </div>
                            <div class="precio-info">
                                <span class="precio-label">Precio final:</span>
                                <span class="precio-valor precio-final-destacado">$<span id="precioFinal">0.00</span></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label large">
                        <input type="checkbox" name="fraccionado" id="fraccionado">
                        <span class="checkbox-text">¿Este producto puede fraccionarse? (se vende por gramos/litros)</span>
                    </label>
                    <div class="form-help">
                        Si se activa, los clientes podrán comprar fracciones del producto (ej: 250g, 0.5L, etc.)
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <a href="{% url 'admin_products' %}" class="btn-cancel"><i class="fas fa-times"></i> Cancelar</a>
                <button type="submit" class="btn-save"><i class="fas fa-save"></i> Guardar Producto</button>
            </div>
        </form>
    </main>

    <script src="{% static 'js/admin_forms.js' %}"></script>
</body>
</html>